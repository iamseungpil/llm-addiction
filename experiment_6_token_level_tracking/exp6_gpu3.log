/data/miniforge3/envs/llama_sae_env/lib/python3.11/site-packages/transformers/utils/hub.py:111: FutureWarning: Using `TRANSFORMERS_CACHE` is deprecated and will be removed in v5 of Transformers. Use `HF_HOME` instead.
  warnings.warn(
====================================================================================================
EXPERIMENT 6: TOKEN-LEVEL FEATURE TRACKING
====================================================================================================
üîß Loading LLaMA model...
Loading checkpoint shards:   0%|          | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|‚ñà‚ñà‚ñå       | 1/4 [00:01<00:04,  1.46s/it]Loading checkpoint shards:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 2/4 [00:02<00:02,  1.46s/it]Loading checkpoint shards:  75%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñå  | 3/4 [00:04<00:01,  1.46s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 4/4 [00:04<00:00,  1.02s/it]Loading checkpoint shards: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 4/4 [00:04<00:00,  1.18s/it]
‚úÖ Model loaded
üîß Loading SAE for Layer 8...
üîß Loading config: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L8R-8x/hyperparams.json
‚úÖ Loading WORKING SAE for Layer 8
   Config: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L8R-8x/hyperparams.json
   Dataset norm: 6.3125
   Norm factor: 10.138614
   Using ReLU instead of JumpReLU (threshold=0.0)
üîß Loading checkpoint: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L8R-8x/checkpoints/final.safetensors
   File size: 512.1 MB
üîß Initializing SAE model...
üîß Loading checkpoint weights (CPU)...
‚úÖ Loaded safetensors file
üîß Processing checkpoint weights...
   Loading W_E (encoder.weight)... converted... ‚úÖ (torch.Size([4096, 32768]))
   Loading b_E (encoder.bias)... converted... ‚úÖ (torch.Size([32768]))
   Loading W_D (decoder.weight)... converted... ‚úÖ (torch.Size([32768, 4096]))
   Loading b_D (decoder.bias)... converted... ‚úÖ (torch.Size([4096]))
üîß Clearing checkpoint from memory...
üîß Loading state dict to model...
üîß Moving model to cuda:0...
‚úÖ OPTIMIZED SAE loaded successfully!
   Layer: 8
   Expected reconstruction error: ~47%
   Feature clamping: VERIFIED WORKING
   Memory optimizations: ENABLED
‚úÖ SAE Layer 8 loaded
üîß Loading SAE for Layer 15...
üîß Loading config: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L15R-8x/hyperparams.json
‚úÖ Loading WORKING SAE for Layer 15
   Config: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L15R-8x/hyperparams.json
   Dataset norm: 10.8125
   Norm factor: 5.919075
   Using ReLU instead of JumpReLU (threshold=0.0)
üîß Loading checkpoint: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L15R-8x/checkpoints/final_fixed.pth
   File size: 512.1 MB
üîß Initializing SAE model...
üîß Loading checkpoint weights (CPU)...
‚úÖ Loaded PyTorch file
üîß Processing checkpoint weights...
   Loading W_E (W_E)... converted... ‚úÖ (torch.Size([4096, 32768]))
   Loading b_E (b_E)... converted... ‚úÖ (torch.Size([32768]))
   Loading W_D (W_D)... converted... ‚úÖ (torch.Size([32768, 4096]))
   Loading b_D (b_D)... converted... ‚úÖ (torch.Size([4096]))
üîß Clearing checkpoint from memory...
üîß Loading state dict to model...
üîß Moving model to cuda:0...
‚úÖ OPTIMIZED SAE loaded successfully!
   Layer: 15
   Expected reconstruction error: ~47%
   Feature clamping: VERIFIED WORKING
   Memory optimizations: ENABLED
‚úÖ SAE Layer 15 loaded
üîß Loading SAE for Layer 31...
üîß Loading config: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L31R-8x/hyperparams.json
‚úÖ Loading WORKING SAE for Layer 31
   Config: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L31R-8x/hyperparams.json
   Dataset norm: 74.5
   Norm factor: 0.859060
   Using ReLU instead of JumpReLU (threshold=0.0)
üîß Loading checkpoint: /data/.cache/huggingface/hub/models--fnlp--Llama3_1-8B-Base-LXR-8x/snapshots/8dbc1d85edfced43081c03c38b05514dbab1368b/Llama3_1-8B-Base-L31R-8x/checkpoints/final.safetensors
   File size: 512.1 MB
üîß Initializing SAE model...
üîß Loading checkpoint weights (CPU)...
‚úÖ Loaded safetensors file
üîß Processing checkpoint weights...
   Loading W_E (encoder.weight)... converted... ‚úÖ (torch.Size([4096, 32768]))
   Loading b_E (encoder.bias)... converted... ‚úÖ (torch.Size([32768]))
   Loading W_D (decoder.weight)... converted... ‚úÖ (torch.Size([32768, 4096]))
   Loading b_D (decoder.bias)... converted... ‚úÖ (torch.Size([4096]))
üîß Clearing checkpoint from memory...
üîß Loading state dict to model...
üîß Moving model to cuda:0...
‚úÖ OPTIMIZED SAE loaded successfully!
   Layer: 31
   Expected reconstruction error: ~47%
   Feature clamping: VERIFIED WORKING
   Memory optimizations: ENABLED
‚úÖ SAE Layer 31 loaded
Processing scenarios:   0%|          | 0/10 [00:00<?, ?it/s]Processing scenarios:  10%|‚ñà         | 1/10 [00:03<00:34,  3.78s/it]Processing scenarios:  20%|‚ñà‚ñà        | 2/10 [00:05<00:19,  2.38s/it]Processing scenarios:  30%|‚ñà‚ñà‚ñà       | 3/10 [00:05<00:11,  1.60s/it]Processing scenarios:  40%|‚ñà‚ñà‚ñà‚ñà      | 4/10 [00:07<00:10,  1.78s/it]Processing scenarios:  50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 5/10 [00:08<00:07,  1.41s/it]Processing scenarios:  60%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà    | 6/10 [00:09<00:04,  1.11s/it]Processing scenarios:  70%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà   | 7/10 [00:09<00:03,  1.01s/it]Processing scenarios:  80%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà  | 8/10 [00:10<00:01,  1.07it/s]Processing scenarios:  90%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà | 9/10 [00:11<00:00,  1.11it/s]Processing scenarios: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:12<00:00,  1.17it/s]Processing scenarios: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 10/10 [00:12<00:00,  1.23s/it]

====================================================================================================
Scenario: Bankruptcy_90_all_in
Balance: $90
====================================================================================================

üîç Extracting features for: Bankruptcy_90_all_in
  Tokens: 121
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($90): [51]
  Goal ($200/Î™©Ìëú/2Î∞∞): [76]
  Probability (30%/3.0Î∞∞): [82]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
Scenario: Desperate_10
Balance: $10
====================================================================================================

üîç Extracting features for: Desperate_10
  Tokens: 135
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($10): [28, 42, 48]
  Goal ($200/Î™©Ìëú/2Î∞∞): [90]
  Probability (30%/3.0Î∞∞): [20, 96]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
Scenario: Safe_130_one_win
Balance: $130
====================================================================================================

üîç Extracting features for: Safe_130_one_win
  Tokens: 96
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($130): [20, 26]
  Goal ($200/Î™©Ìëú/2Î∞∞): [51]
  Probability (30%/3.0Î∞∞): [20, 26, 57]
  Choices (Bet/Stop): [12, 81]

====================================================================================================
Scenario: Risky_40
Balance: $40
====================================================================================================

üîç Extracting features for: Risky_40
  Tokens: 124
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($40): [48, 54]
  Goal ($200/Î™©Ìëú/2Î∞∞): [79]
  Probability (30%/3.0Î∞∞): [28, 85]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
Scenario: Safe_140_near_goal
Balance: $140
====================================================================================================

üîç Extracting features for: Safe_140_near_goal
  Tokens: 110
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($140): [34, 40]
  Goal ($200/Î™©Ìëú/2Î∞∞): [65]
  Probability (30%/3.0Î∞∞): [71]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
Scenario: Initial_100_first_round
Balance: $100
====================================================================================================

üîç Extracting features for: Initial_100_first_round
  Tokens: 79
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($100): [9, 70]
  Goal ($200/Î™©Ìëú/2Î∞∞): [34]
  Probability (30%/3.0Î∞∞): [40]
  Choices (Bet/Stop): [64, 74]

====================================================================================================
Scenario: Medium_60
Balance: $60
====================================================================================================

üîç Extracting features for: Medium_60
  Tokens: 124
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($60): [48, 54]
  Goal ($200/Î™©Ìëú/2Î∞∞): [79]
  Probability (30%/3.0Î∞∞): [28, 42, 85]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
Scenario: Goal_achieved_200
Balance: $200
====================================================================================================

üîç Extracting features for: Goal_achieved_200
  Tokens: 110
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($200): [34, 40, 65]
  Goal ($200/Î™©Ìëú/2Î∞∞): [34, 40, 65]
  Probability (30%/3.0Î∞∞): [71]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
Scenario: Very_risky_25
Balance: $25
====================================================================================================

üîç Extracting features for: Very_risky_25
  Tokens: 121
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($25): [34, 51]
  Goal ($200/Î™©Ìëú/2Î∞∞): [76]
  Probability (30%/3.0Î∞∞): [82]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
Scenario: Big_success_280
Balance: $280
====================================================================================================

üîç Extracting features for: Big_success_280
  Tokens: 110
  First 5: ['<|begin_of_text|>', 'Slot', ' Machine', ' Game', '\n\n']
  Last 5: [' Stop', '\n\n', 'Choice', ':', ' ']
  Processing Layer 8...
  Processing Layer 15...
  Processing Layer 31...

üîç Key token positions:
  Balance ($280): [34, 40]
  Goal ($200/Î™©Ìëú/2Î∞∞): [65]
  Probability (30%/3.0Î∞∞): [20, 71]
  Choices (Bet/Stop): [12, 26]

====================================================================================================
EXPERIMENT COMPLETE
====================================================================================================
‚úÖ Saved: /data/llm_addiction/experiment_6_token_level/token_level_tracking_20251013_145433.json
üíæ File size: 2469.02 MB
üìä Scenarios: 10

üéØ Next: Analyze results with:
python analyze_token_attribution.py /data/llm_addiction/experiment_6_token_level/token_level_tracking_20251013_145433.json
